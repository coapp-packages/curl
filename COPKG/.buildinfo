@import default_tools;

default {

    .Copy {
        SourceFiles : {
            $(MSBuildThisFileDirectory)..\include\curl\curlbuild.h.dist,
            $(MSBuildThisFileDirectory)..\src\tool_hugehelp.c.cvs,
            $(MSBuildThisFileDirectory)..\lib\config-win32.h,
        };
        DestinationFiles : {
            $(MSBuildThisFileDirectory)..\include\curl\curlbuild.h,
            $(MSBuildThisFileDirectory)..\src\tool_hugehelp.c,
            $(MSBuildThisFileDirectory)..\lib\config.h,
        };
    };
    
    .Exec {
        Condition="Exists('$(MSBuildThisFileDirectory)packages.config')";
        Command = @"nuget install $(MSBuildThisFileDirectory)packages.config -x -OutputDirectory .\packages >nul";
    };

	// ("v110, v100", "Win32, x64", "Debug,Release", "Dynamic, Static, ltcg", "cdecl") => {
	("v110, v100", "Win32, x64", "Debug,Release", "Static, ltcg", "cdecl") => {
		.PushEnvironment {};
		.LoadSystemEnvironment {};
        .SetEnvironmentFromTarget.Target = "VC_${0}_${1}";
		.Message.Text = @"


        Env:        ${0}-${1}  :  ${2}  ${3}  ${4}
        EnvExists:  $(IsEnvironmentValid)";
        
        .Exec {
            Condition="$(IsEnvironmentValid)";
            Command = @"msbuild $(MSBuildThisFileDirectory)libcurl.vcxproj /p:PlatformToolset=${0};Platform=${1};Configuration=${2};UsesConfigurationType=${3};CallingConvention=${4}";
        };
        .Exec {
            Condition="$(IsEnvironmentValid)";
            Command = @"msbuild $(MSBuildThisFileDirectory)curl.vcxproj    /p:PlatformToolset=${0};Platform=${1};Configuration=${2};UsesConfigurationType=${3};CallingConvention=${4}";
        };
        
        .PopEnvironment{};
	};
	
};

clean {
    .RemoveDir.Directories = @"$(MSBuildThisFileDirectory).\intermediate";
};

nuke {
    .RemoveDir.Directories = @"$(MSBuildThisFileDirectory).\output";
};
